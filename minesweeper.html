<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minesweeper - ThangMedia</title>
    <style>
        /* --- KH·∫ÆC PH·ª§C THANH TR∆Ø·ª¢T --- */
        * {
            box-sizing: border-box; /* T√≠nh k√≠ch th∆∞·ªõc bao g·ªìm c·∫£ vi·ªÅn */
        }
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* C·∫•m tuy·ªát ƒë·ªëi thanh cu·ªôn */
            background: white;
            color: black;
            font-family: sans-serif;
            text-align: center;
        }
        
        /* D√πng Flexbox ƒë·ªÉ cƒÉn gi·ªØa to√†n m√†n h√¨nh */
        body {
            display: flex;
            flex-direction: column;
            justify-content: center; /* CƒÉn gi·ªØa d·ªçc */
            align-items: center; /* CƒÉn gi·ªØa ngang */
        }

        h2 {
            margin: 5px 0;
            border-bottom: 2px solid black;
            font-size: 22px;
        }
        
        /* C√°c n√∫t b·∫•m g·ªçn h∆°n ch√∫t */
        button {
            background: white;
            border: 2px solid black;
            color: black;
            padding: 5px 10px; /* Gi·∫£m padding */
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 3px;
            border-radius: 4px;
        }
        
        button:active, button.active-mode, button.active-difficulty {
            background: black;
            color: white;
        }

        .controls, .difficulty-selector, .mode-controls {
            margin: 5px 0;
        }

        #board {
            display: inline-block;
            border: 2px solid black;
            margin: 5px auto;
            background: #999;
            padding: 1px;
        }
        
        .row { display: flex; }
        
        .cell {
            background: white;
            border: 1px solid #999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
        }
        
        .cell.revealed { background: #ddd; border: 1px solid #666; }
        .cell.bomb { background: black; color: white; }
        
        .back-link {
            display: inline-block;
            margin-top: 10px;
            text-decoration: none;
            font-size: 16px;
            font-weight: bold;
            border: 1px solid black;
            padding: 8px 15px;
            color: black;
        }
    </style>
</head>
<body>

    <h2 id="status">MINES: 10</h2>
    
    <div class="difficulty-selector">
        <button onclick="setDifficulty('easy')" id="easyBtn" class="active-difficulty">EASY</button>
        <button onclick="setDifficulty('medium')" id="mediumBtn">MED</button>
        <button onclick="setDifficulty('hard')" id="hardBtn">HARD</button>
    </div>
    
    <div class="controls">
        <button onclick="initGame()">NEW GAME</button>
    </div>

    <div id="board"></div>
    
    <div class="mode-controls">
        <button onclick="setMode('dig')" id="digBtn" class="active-mode">DIG ‚õèÔ∏è</button>
        <button onclick="setMode('flag')" id="flagBtn">FLAG üö©</button>
    </div>

    <a href="index.html" class="back-link">HOME</a>

    <script>
        var difficulty = 'easy';
        var ROWS = 8; var COLS = 8; var MINES = 10;
        var grid = []; var gameOver = false; var isFlagMode = false;

        function setDifficulty(level) {
            difficulty = level;
            document.getElementById('easyBtn').className = '';
            document.getElementById('mediumBtn').className = '';
            document.getElementById('hardBtn').className = '';
            
            if (level === 'easy') {
                ROWS = 8; COLS = 8; MINES = 10;
                document.getElementById('easyBtn').className = 'active-difficulty';
            } else if (level === 'medium') {
                ROWS = 10; COLS = 10; MINES = 20;
                document.getElementById('mediumBtn').className = 'active-difficulty';
            } else if (level === 'hard') {
                ROWS = 12; COLS = 12; MINES = 40;
                document.getElementById('hardBtn').className = 'active-difficulty';
            }
            initGame();
        }

        function initGame() {
            var boardDiv = document.getElementById("board");
            boardDiv.innerHTML = "";
            document.getElementById("status").innerText = "MINES: " + MINES;
            gameOver = false;
            grid = [];
            isFlagMode = false;
            setMode('dig');
            
            // GI·∫¢M K√çCH TH∆Ø·ªöC √î XU·ªêNG CH√öT ƒê·ªÇ V·ª™A KH√çT
            var cellSize = difficulty === 'easy' ? 80 : (difficulty === 'medium' ? 65 : 50);
            var fontSize = difficulty === 'easy' ? 30 : (difficulty === 'medium' ? 24 : 18);
            
            for (var r = 0; r < ROWS; r++) {
                var row = [];
                var rowDiv = document.createElement("div");
                rowDiv.className = "row";
                for (var c = 0; c < COLS; c++) {
                    var cell = { r: r, c: c, isMine: false, isOpen: false, isFlag: false, count: 0, div: document.createElement("div") };
                    cell.div.className = "cell";
                    cell.div.style.width = cellSize + "px";
                    cell.div.style.height = cellSize + "px";
                    cell.div.style.fontSize = fontSize + "px";
                    
                    cell.div.onclick = (function(d){ return function() { handleClick(d); }; })(cell);
                    row.push(cell);
                    rowDiv.appendChild(cell.div);
                }
                grid.push(row);
                boardDiv.appendChild(rowDiv);
            }

            var minesPlaced = 0;
            while (minesPlaced < MINES) {
                var rr = Math.floor(Math.random() * ROWS);
                var cc = Math.floor(Math.random() * COLS);
                if (!grid[rr][cc].isMine) { grid[rr][cc].isMine = true; minesPlaced++; }
            }

            for (var r = 0; r < ROWS; r++) {
                for (var c = 0; c < COLS; c++) {
                    if (!grid[r][c].isMine) grid[r][c].count = countMines(r, c);
                }
            }
        }

        function countMines(r, c) {
            var count = 0;
            for (var i = -1; i <= 1; i++) {
                for (var j = -1; j <= 1; j++) {
                    var nr = r + i, nc = c + j;
                    if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS && grid[nr][nc].isMine) count++;
                }
            }
            return count;
        }

        function setMode(mode) {
            if (mode === 'dig') { isFlagMode = false; document.getElementById('digBtn').className = 'active-mode'; document.getElementById('flagBtn').className = ''; }
            else { isFlagMode = true; document.getElementById('digBtn').className = ''; document.getElementById('flagBtn').className = 'active-mode'; }
        }

        function handleClick(cell) {
            if (gameOver || (cell.isOpen && !isFlagMode)) return;
            if (isFlagMode) {
                if (!cell.isOpen) { cell.isFlag = !cell.isFlag; cell.div.innerText = cell.isFlag ? "F" : ""; cell.div.className = cell.isFlag ? "cell flag" : "cell"; }
            } else {
                if (cell.isFlag) return;
                if (cell.isMine) { revealMines(); document.getElementById("status").innerText = "GAME OVER!"; gameOver = true; }
                else { openCell(cell); checkWin(); }
            }
        }

        function openCell(cell) {
            if (cell.isOpen || cell.isFlag) return;
            cell.isOpen = true; cell.div.className = "cell revealed";
            if (cell.count > 0) cell.div.innerText = cell.count;
            else {
                for (var i = -1; i <= 1; i++) {
                    for (var j = -1; j <= 1; j++) {
                        var nr = cell.r + i, nc = cell.c + j;
                        if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) openCell(grid[nr][nc]);
                    }
                }
            }
        }

        function revealMines() {
            for (var r = 0; r < ROWS; r++) { for (var c = 0; c < COLS; c++) { if (grid[r][c].isMine) { grid[r][c].div.className = "cell bomb"; grid[r][c].div.innerText = "X"; } } }
        }

        function checkWin() {
            var opened = 0;
            for (var r = 0; r < ROWS; r++) { for (var c = 0; c < COLS; c++) { if (grid[r][c].isOpen) opened++; } }
            if (opened === (ROWS * COLS - MINES)) { document.getElementById("status").innerText = "YOU WIN!"; gameOver = true; }
        }

        initGame();
    </script>
</body>
</html>