<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Minesweeper - ThangMedia</title>
    <style>
        /* CSS cho E-ink */
        body {
            font-family: sans-serif;
            text-align: center;
            margin: 0;
            padding: 5px;
            background: white;
            color: black;
        }
        
        h2 {
            margin: 10px 0;
            border-bottom: 2px solid black;
            font-size: 24px;
        }
        
        .controls {
            margin-bottom: 15px;
        }
        
        .difficulty-selector {
            margin-bottom: 10px;
        }
        
        .difficulty-selector button {
            background: white;
            border: 2px solid black;
            color: black;
            padding: 8px 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 3px;
            border-radius: 4px;
        }
        
        .difficulty-selector button:active {
            background: black;
            color: white;
        }
        
        .difficulty-selector button.active-difficulty {
            background: black;
            color: white;
        }
        
        button {
            background: white;
            border: 2px solid black;
            color: black;
            padding: 10px 18px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 5px;
            border-radius: 4px;
        }
        
        button:active {
            background: black;
            color: white;
        }
        
        button.active-mode {
            background: black;
            color: white;
        }

        #board {
            display: inline-block;
            border: 2px solid black;
            margin: 5px auto;
            background: #999;
            padding: 1px;
        }
        
        .row {
            display: block;
            white-space: nowrap;
        }
        
        .cell {
            width: 50px;
            height: 50px;
            background: white;
            border: 1px solid #999;
            display: inline-block;
            text-align: center;
            vertical-align: middle;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            line-height: 50px;
            margin: 0;
            padding: 0;
        }
        
        .cell.revealed {
            background: #ddd;
            color: black;
            border: 2px solid #666;
        }
        
        .cell.bomb {
            background: black;
            color: white;
        }
        
        .cell.flag {
            color: black;
        }
        
        /* Màu số */
        .c1 { color: black; }
        .c2 { color: black; }
        .c3 { color: black; }
        /* Trên E-ink thì cứ đen hết cho rõ */

        .back-link {
            display: block;
            margin-top: 20px;
            text-decoration: none;
            font-size: 20px;
            font-weight: bold;
            border: 1px solid black;
            padding: 12px;
        }
    </style>
</head>
<body>

    <h2 id="status">MINES: 10</h2>
    
    <div class="difficulty-selector">
        <button onclick="setDifficulty('easy')" id="easyBtn" class="active-difficulty">EASY</button>
        <button onclick="setDifficulty('medium')" id="mediumBtn">MEDIUM</button>
        <button onclick="setDifficulty('hard')" id="hardBtn">HARD</button>
    </div>
    
    <div class="controls">
        <button onclick="toggleMode()" id="modeBtn" class="active-mode">REVEAL</button>
        <button onclick="initGame()">NEW GAME</button>
    </div>

    <div id="board"></div>

    <a href="index.html" class="back-link">BACK TO HOME</a>

    <script>
        // Cấu hình độ khó
        var difficulty = 'easy';
        var ROWS = 8;
        var COLS = 8;
        var MINES = 10;
        
        var grid = [];
        var gameOver = false;
        var isFlagMode = false; // False = Mở ô, True = Cắm cờ
        var minesRemaining = MINES;
        
        function setDifficulty(level) {
            difficulty = level;
            
            // Cập nhật UI
            document.getElementById('easyBtn').className = '';
            document.getElementById('mediumBtn').className = '';
            document.getElementById('hardBtn').className = '';
            
            if (level === 'easy') {
                ROWS = 8;
                COLS = 8;
                MINES = 10;
                document.getElementById('easyBtn').className = 'active-difficulty';
            } else if (level === 'medium') {
                ROWS = 10;
                COLS = 10;
                MINES = 20;
                document.getElementById('mediumBtn').className = 'active-difficulty';
            } else if (level === 'hard') {
                ROWS = 12;
                COLS = 12;
                MINES = 40;
                document.getElementById('hardBtn').className = 'active-difficulty';
            }
            
            // Tạo lại game với cấu hình mới
            initGame();
        }

        function initGame() {
            var boardDiv = document.getElementById("board");
            boardDiv.innerHTML = "";
            document.getElementById("status").innerText = "MINES: " + MINES;
            gameOver = false;
            grid = [];
            minesRemaining = MINES;
            
            // Điều chỉnh kích thước ô theo độ khó
            var cellSize = difficulty === 'easy' ? 70 : (difficulty === 'medium' ? 60 : 50);
            var fontSize = difficulty === 'easy' ? 26 : (difficulty === 'medium' ? 22 : 20);
            
            // Tạo lưới dữ liệu
            for (var r = 0; r < ROWS; r++) {
                var row = [];
                var rowDiv = document.createElement("div");
                rowDiv.className = "row";
                for (var c = 0; c < COLS; c++) {
                    var cell = {
                        r: r, c: c,
                        isMine: false,
                        isOpen: false,
                        isFlag: false,
                        count: 0,
                        div: document.createElement("div")
                    };
                    cell.div.className = "cell";
                    cell.div.style.width = cellSize + "px";
                    cell.div.style.height = cellSize + "px";
                    cell.div.style.fontSize = fontSize + "px";
                    cell.div.style.lineHeight = cellSize + "px";
                    
                    // Xử lý sự kiện click (Closure để giữ biến r,c)
                    cell.div.onclick = (function(cellData){
                        return function() { handleClick(cellData); };
                    })(cell);

                    row.push(cell);
                    rowDiv.appendChild(cell.div);
                }
                grid.push(row);
                boardDiv.appendChild(rowDiv);
            }

            // Rải mìn ngẫu nhiên
            var minesPlaced = 0;
            while (minesPlaced < MINES) {
                var rr = Math.floor(Math.random() * ROWS);
                var cc = Math.floor(Math.random() * COLS);
                if (!grid[rr][cc].isMine) {
                    grid[rr][cc].isMine = true;
                    minesPlaced++;
                }
            }

            // Tính số mìn xung quanh
            for (var r = 0; r < ROWS; r++) {
                for (var c = 0; c < COLS; c++) {
                    if (!grid[r][c].isMine) {
                        grid[r][c].count = countMines(r, c);
                    }
                }
            }
        }

        function countMines(r, c) {
            var count = 0;
            for (var i = -1; i <= 1; i++) {
                for (var j = -1; j <= 1; j++) {
                    var nr = r + i, nc = c + j;
                    if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
                        if (grid[nr][nc].isMine) count++;
                    }
                }
            }
            return count;
        }

        function toggleMode() {
            isFlagMode = !isFlagMode;
            var btn = document.getElementById("modeBtn");
            if (isFlagMode) {
                btn.innerText = "FLAG";
                btn.className = ""; // Bỏ style đen
            } else {
                btn.innerText = "REVEAL";
                btn.className = "active-mode"; // Thêm style đen
            }
        }

        function handleClick(cell) {
            if (gameOver || (cell.isOpen && !isFlagMode)) return;

            if (isFlagMode) {
                // Chế độ cắm cờ
                if (!cell.isOpen) {
                    cell.isFlag = !cell.isFlag;
                    cell.div.innerText = cell.isFlag ? "F" : "";
                    cell.div.className = cell.isFlag ? "cell flag" : "cell";
                }
            } else {
                // Chế độ mở ô
                if (cell.isFlag) return; // Không mở ô có cờ
                
                if (cell.isMine) {
                    revealMines();
                    document.getElementById("status").innerText = "GAME OVER!";
                    gameOver = true;
                } else {
                    openCell(cell);
                    checkWin();
                }
            }
        }

        function openCell(cell) {
            if (cell.isOpen || cell.isFlag) return;
            cell.isOpen = true;
            cell.div.className = "cell revealed";
            
            if (cell.count > 0) {
                cell.div.innerText = cell.count;
            } else {
                // Nếu là ô trống (0), mở loang ra
                for (var i = -1; i <= 1; i++) {
                    for (var j = -1; j <= 1; j++) {
                        var nr = cell.r + i, nc = cell.c + j;
                        if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
                            openCell(grid[nr][nc]);
                        }
                    }
                }
            }
        }

        function revealMines() {
            for (var r = 0; r < ROWS; r++) {
                for (var c = 0; c < COLS; c++) {
                    if (grid[r][c].isMine) {
                        grid[r][c].div.className = "cell bomb";
                        grid[r][c].div.innerText = "X";
                    }
                }
            }
        }

        function checkWin() {
            var openedCount = 0;
            for (var r = 0; r < ROWS; r++) {
                for (var c = 0; c < COLS; c++) {
                    if (grid[r][c].isOpen) openedCount++;
                }
            }
            if (openedCount === (ROWS * COLS - MINES)) {
                document.getElementById("status").innerText = "YOU WIN!";
                gameOver = true;
            }
        }

        // Bắt đầu game khi tải trang
        initGame();
    </script>
</body>
</html>
