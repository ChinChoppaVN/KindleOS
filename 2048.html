<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>2048 - ThangMedia</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            margin: 0;
            padding: 5px;
            background: white;
            color: black;
        }
        
        h2 {
            margin: 5px 0;
            border-bottom: 2px solid black;
            position: relative;
            padding-right: 40px;
        }
        
        .close-btn {
            position: absolute;
            right: 0;
            top: 0;
            width: 35px;
            height: 35px;
            background: white;
            border: 2px solid black;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            line-height: 31px;
            text-align: center;
        }
        
        .close-btn:active {
            background: black;
            color: white;
        }
        
        .controls {
            margin-bottom: 10px;
        }
        
        button {
            background: white;
            border: 2px solid black;
            color: black;
            padding: 8px 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 5px;
            border-radius: 4px;
        }
        
        button:active {
            background: black;
            color: white;
        }
        
        .difficulty-selector {
            margin-bottom: 10px;
        }
        
        .difficulty-selector button {
            background: white;
            border: 2px solid black;
            color: black;
            padding: 8px 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 3px;
            border-radius: 4px;
        }
        
        .difficulty-selector button:active {
            background: black;
            color: white;
        }
        
        .difficulty-selector button.active-difficulty {
            background: black;
            color: white;
        }

        #grid {
            border-collapse: collapse;
            margin: 10px auto;
            border: 3px solid black;
        }
        
        #grid td {
            width: 180px;
            height: 180px;
            border: 2px solid black;
            text-align: center;
            vertical-align: middle;
            font-size: 64px;
            font-weight: bold;
            background: white;
        }
        
        /* Number cells */
        .cell-2 { background: #eee; }
        .cell-4 { background: #ddd; }
        .cell-8 { background: #ccc; }
        .cell-16 { background: #bbb; }
        .cell-32 { background: #aaa; }
        .cell-64 { background: #999; }
        .cell-128 { background: #888; }
        .cell-256 { background: #777; }
        .cell-512 { background: #666; color: white; }
        .cell-1024 { background: #555; color: white; }
        .cell-2048 { background: #000; color: white; }
        
        /* Direction controls */
        .controls {
            padding: 15px;
        }
        
        .control-row {
            text-align: center;
            margin: 5px 0;
        }
        
        .arrow-btn {
            width: 60px;
            height: 60px;
            background: white;
            border: 2px solid black;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            display: inline-block;
            margin: 3px;
            line-height: 56px;
        }
        
        .arrow-btn:active {
            background: black;
            color: white;
        }
        
    </style>
</head>
<body>

    <h2 id="status">2048<span class="close-btn" onclick="window.location.href='index.html'">X</span></h2>
    <div class="difficulty-selector">
        <button onclick="setDifficulty('easy')" id="easyBtn" class="active-difficulty">EASY</button>
        <button onclick="setDifficulty('medium')" id="mediumBtn">MEDIUM</button>
        <button onclick="setDifficulty('hard')" id="hardBtn">HARD</button>
    </div>
    <div class="controls">
        <span>Score: <span id="score">0</span></span> | 
        <span>Best: <span id="best">0</span></span>
        <button onclick="resetGame()">RESET</button>
    </div>

    <table id="grid"></table>

    <div class="controls">
        <div class="control-row">
            <div class="arrow-btn" onclick="move('up')">↑</div>
        </div>
        <div class="control-row">
            <div class="arrow-btn" onclick="move('left')">←</div>
            <div class="arrow-btn" onclick="move('down')">↓</div>
            <div class="arrow-btn" onclick="move('right')">→</div>
        </div>
    </div>
    

    <script>
        var grid = [];
        var score = 0;
        var best = 0;
        var difficulty = 'easy';
        var SIZE = 4;
        
        // Load best score from localStorage
        function loadBestScore() {
            var key = '2048best_' + difficulty;
            if (localStorage.getItem(key)) {
                best = parseInt(localStorage.getItem(key));
                document.getElementById('best').innerText = best;
            } else {
                best = 0;
                document.getElementById('best').innerText = best;
            }
        }
        
        loadBestScore();
        
        function initGame() {
            grid = [];
            score = 0;
            document.getElementById('score').innerText = score;
            
            // Create empty grid
            for (var r = 0; r < SIZE; r++) {
                grid[r] = [];
                for (var c = 0; c < SIZE; c++) {
                    grid[r][c] = 0;
                }
            }
            
            // Add two random tiles
            addRandomTile();
            addRandomTile();
            
            updateDisplay();
        }
        
        function addRandomTile() {
            var emptyCells = [];
            for (var r = 0; r < SIZE; r++) {
                for (var c = 0; c < SIZE; c++) {
                    if (grid[r][c] === 0) {
                        emptyCells.push({r: r, c: c});
                    }
                }
            }
            
            if (emptyCells.length > 0) {
                var randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                grid[randomCell.r][randomCell.c] = Math.random() < 0.9 ? 2 : 4;
            }
        }
        
        function updateDisplay() {
            var table = document.getElementById('grid');
            table.innerHTML = '';
            
            // Điều chỉnh kích thước ô theo độ khó
            var cellSize = difficulty === 'easy' ? 180 : (difficulty === 'medium' ? 120 : 90);
            var fontSize = difficulty === 'easy' ? 64 : (difficulty === 'medium' ? 42 : 32);
            
            for (var r = 0; r < SIZE; r++) {
                var tr = document.createElement('tr');
                for (var c = 0; c < SIZE; c++) {
                    var td = document.createElement('td');
                    var val = grid[r][c];
                    td.style.width = cellSize + 'px';
                    td.style.height = cellSize + 'px';
                    td.style.fontSize = fontSize + 'px';
                    if (val > 0) {
                        td.innerText = val;
                        td.className = 'cell-' + val;
                    }
                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
            
            document.getElementById('score').innerText = score;
            if (score > best) {
                best = score;
                document.getElementById('best').innerText = best;
                localStorage.setItem('2048best_' + difficulty, best);
            }
        }
        
        function move(direction) {
            var moved = false;
            var newGrid = [];
            
            // Copy grid
            for (var r = 0; r < SIZE; r++) {
                newGrid[r] = [];
                for (var c = 0; c < SIZE; c++) {
                    newGrid[r][c] = grid[r][c];
                }
            }
            
            if (direction === 'left') {
                moved = moveLeft(newGrid);
            } else if (direction === 'right') {
                moved = moveRight(newGrid);
            } else if (direction === 'up') {
                moved = moveUp(newGrid);
            } else if (direction === 'down') {
                moved = moveDown(newGrid);
            }
            
            if (moved) {
                grid = newGrid;
                addRandomTile();
                updateDisplay();
                
                // Check game over
                if (isGameOver()) {
                    setTimeout(function() {
                        alert('GAME OVER!');
                    }, 100);
                }
            }
        }
        
        function moveLeft(newGrid) {
            var moved = false;
            for (var r = 0; r < SIZE; r++) {
                var row = [];
                for (var c = 0; c < SIZE; c++) {
                    if (newGrid[r][c] !== 0) {
                        row.push(newGrid[r][c]);
                    }
                }
                
                // Merge
                for (var i = 0; i < row.length - 1; i++) {
                    if (row[i] === row[i + 1]) {
                        row[i] *= 2;
                        score += row[i];
                        row.splice(i + 1, 1);
                    }
                }
                
                // Fill with zeros
                while (row.length < SIZE) {
                    row.push(0);
                }
                
                // Check if moved
                for (var c = 0; c < SIZE; c++) {
                    if (newGrid[r][c] !== row[c]) {
                        moved = true;
                    }
                    newGrid[r][c] = row[c];
                }
            }
            return moved;
        }
        
        function moveRight(newGrid) {
            var moved = false;
            for (var r = 0; r < SIZE; r++) {
                var row = [];
                for (var c = SIZE - 1; c >= 0; c--) {
                    if (newGrid[r][c] !== 0) {
                        row.push(newGrid[r][c]);
                    }
                }
                
                // Merge
                for (var i = 0; i < row.length - 1; i++) {
                    if (row[i] === row[i + 1]) {
                        row[i] *= 2;
                        score += row[i];
                        row.splice(i + 1, 1);
                    }
                }
                
                // Fill with zeros
                while (row.length < SIZE) {
                    row.push(0);
                }
                
                // Reverse and check if moved
                row.reverse();
                for (var c = 0; c < SIZE; c++) {
                    if (newGrid[r][c] !== row[c]) {
                        moved = true;
                    }
                    newGrid[r][c] = row[c];
                }
            }
            return moved;
        }
        
        function moveUp(newGrid) {
            var moved = false;
            for (var c = 0; c < SIZE; c++) {
                var col = [];
                for (var r = 0; r < SIZE; r++) {
                    if (newGrid[r][c] !== 0) {
                        col.push(newGrid[r][c]);
                    }
                }
                
                // Merge
                for (var i = 0; i < col.length - 1; i++) {
                    if (col[i] === col[i + 1]) {
                        col[i] *= 2;
                        score += col[i];
                        col.splice(i + 1, 1);
                    }
                }
                
                // Fill with zeros
                while (col.length < SIZE) {
                    col.push(0);
                }
                
                // Check if moved
                for (var r = 0; r < SIZE; r++) {
                    if (newGrid[r][c] !== col[r]) {
                        moved = true;
                    }
                    newGrid[r][c] = col[r];
                }
            }
            return moved;
        }
        
        function moveDown(newGrid) {
            var moved = false;
            for (var c = 0; c < SIZE; c++) {
                var col = [];
                for (var r = SIZE - 1; r >= 0; r--) {
                    if (newGrid[r][c] !== 0) {
                        col.push(newGrid[r][c]);
                    }
                }
                
                // Merge
                for (var i = 0; i < col.length - 1; i++) {
                    if (col[i] === col[i + 1]) {
                        col[i] *= 2;
                        score += col[i];
                        col.splice(i + 1, 1);
                    }
                }
                
                // Fill with zeros
                while (col.length < SIZE) {
                    col.push(0);
                }
                
                // Reverse and check if moved
                col.reverse();
                for (var r = 0; r < SIZE; r++) {
                    if (newGrid[r][c] !== col[r]) {
                        moved = true;
                    }
                    newGrid[r][c] = col[r];
                }
            }
            return moved;
        }
        
        function isGameOver() {
            // Check for empty cells
            for (var r = 0; r < SIZE; r++) {
                for (var c = 0; c < SIZE; c++) {
                    if (grid[r][c] === 0) {
                        return false;
                    }
                }
            }
            
            // Check for possible merges
            for (var r = 0; r < SIZE; r++) {
                for (var c = 0; c < SIZE; c++) {
                    var val = grid[r][c];
                    if ((r < SIZE - 1 && grid[r + 1][c] === val) ||
                        (c < SIZE - 1 && grid[r][c + 1] === val)) {
                        return false;
                    }
                }
            }
            
            return true;
        }
        
        function setDifficulty(level) {
            difficulty = level;
            
            // Cập nhật UI
            document.getElementById('easyBtn').className = '';
            document.getElementById('mediumBtn').className = '';
            document.getElementById('hardBtn').className = '';
            
            if (level === 'easy') {
                SIZE = 4;
                document.getElementById('easyBtn').className = 'active-difficulty';
            } else if (level === 'medium') {
                SIZE = 6;
                document.getElementById('mediumBtn').className = 'active-difficulty';
            } else if (level === 'hard') {
                SIZE = 8;
                document.getElementById('hardBtn').className = 'active-difficulty';
            }
            
            // Load best score cho độ khó mới
            loadBestScore();
            
            // Tạo lại game với cấu hình mới
            initGame();
        }
        
        function resetGame() {
            initGame();
        }
        
        // Initialize game
        initGame();
    </script>
</body>
</html>
