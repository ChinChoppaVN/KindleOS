<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>D√≤ M√¨n - ThangMedia</title>
    <style>
        /* CSS cho E-ink */
        body { font-family: sans-serif; text-align: center; margin: 0; padding: 5px; background: white; color: black; }
        h2 { margin: 5px 0; border-bottom: 2px solid black; }
        
        .controls { margin-bottom: 10px; }
        button {
            background: white; border: 2px solid black; color: black;
            padding: 8px 15px; font-size: 16px; font-weight: bold;
            cursor: pointer; margin: 0 5px; border-radius: 4px;
        }
        button:active { background: black; color: white; }
        button.active-mode { background: black; color: white; }

        #board {
            display: table; 
            border: 2px solid black; 
            margin: 5px auto;
            border-collapse: separate;
            border-spacing: 0;
            background: #999; /* M√†u ƒë∆∞·ªùng k·∫ª */
        }
        .row { 
            display: table-row; 
        }
        .cell {
            width: 38px; height: 38px; /* √î to d·ªÖ b·∫•m */
            background: white;
            border: 1px solid #999;
            display: table-cell;
            text-align: center;
            vertical-align: middle;
            font-size: 20px; font-weight: bold;
            cursor: pointer;
            user-select: none; /* Ch·ªëng b√¥i ƒëen */
        }
        
        .cell.revealed { background: #eee; color: black; }
        .cell.bomb { background: black; color: white; }
        .cell.flag { color: black; }
        
        /* M√†u s·ªë */
        .c1 { color: black; } .c2 { color: black; } .c3 { color: black; } 
        /* Tr√™n E-ink th√¨ c·ª© ƒëen h·∫øt cho r√µ */

        .back-link { display: block; margin-top: 20px; text-decoration: none; font-size: 18px; font-weight: bold; border: 1px solid black; padding: 10px; }
    </style>
</head>
<body>

    <h2 id="status">M√åN: 10</h2>
    
    <div class="controls">
        <button onclick="toggleMode()" id="modeBtn" class="active-mode">M·ªû √î</button>
        <button onclick="initGame()">CH∆†I L·∫†I</button>
    </div>

    <div id="board"></div>

    <a href="index.html" class="back-link">‚¨Ö V·ªÄ TRANG CH·ª¶</a>

    <script>
        // C·∫•u h√¨nh
        var ROWS = 9;
        var COLS = 8; // B·ªÅ ngang Kindle PPW3 h·∫πp n√™n ƒë·ªÉ 8
        var MINES = 10;
        
        var grid = [];
        var gameOver = false;
        var isFlagMode = false; // False = M·ªü √¥, True = C·∫Øm c·ªù
        var minesRemaining = MINES;

        function initGame() {
            var boardDiv = document.getElementById("board");
            boardDiv.innerHTML = "";
            document.getElementById("status").innerText = "M√åN: " + MINES;
            gameOver = false;
            grid = [];
            minesRemaining = MINES;
            
            // T·∫°o l∆∞·ªõi d·ªØ li·ªáu
            for (var r = 0; r < ROWS; r++) {
                var row = [];
                var rowDiv = document.createElement("div");
                rowDiv.className = "row";
                for (var c = 0; c < COLS; c++) {
                    var cell = {
                        r: r, c: c,
                        isMine: false,
                        isOpen: false,
                        isFlag: false,
                        count: 0,
                        div: document.createElement("div")
                    };
                    cell.div.className = "cell";
                    
                    // X·ª≠ l√Ω s·ª± ki·ªán click (Closure ƒë·ªÉ gi·ªØ bi·∫øn r,c)
                    cell.div.onclick = (function(cellData){
                        return function() { handleClick(cellData); };
                    })(cell);

                    row.push(cell);
                    rowDiv.appendChild(cell.div);
                }
                grid.push(row);
                boardDiv.appendChild(rowDiv);
            }

            // R·∫£i m√¨n ng·∫´u nhi√™n
            var minesPlaced = 0;
            while (minesPlaced < MINES) {
                var rr = Math.floor(Math.random() * ROWS);
                var cc = Math.floor(Math.random() * COLS);
                if (!grid[rr][cc].isMine) {
                    grid[rr][cc].isMine = true;
                    minesPlaced++;
                }
            }

            // T√≠nh s·ªë m√¨n xung quanh
            for (var r = 0; r < ROWS; r++) {
                for (var c = 0; c < COLS; c++) {
                    if (!grid[r][c].isMine) {
                        grid[r][c].count = countMines(r, c);
                    }
                }
            }
        }

        function countMines(r, c) {
            var count = 0;
            for (var i = -1; i <= 1; i++) {
                for (var j = -1; j <= 1; j++) {
                    var nr = r + i, nc = c + j;
                    if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
                        if (grid[nr][nc].isMine) count++;
                    }
                }
            }
            return count;
        }

        function toggleMode() {
            isFlagMode = !isFlagMode;
            var btn = document.getElementById("modeBtn");
            if (isFlagMode) {
                btn.innerText = "C·∫ÆM C·ªú üö©";
                btn.className = ""; // B·ªè style ƒëen
            } else {
                btn.innerText = "M·ªû √î";
                btn.className = "active-mode"; // Th√™m style ƒëen
            }
        }

        function handleClick(cell) {
            if (gameOver || (cell.isOpen && !isFlagMode)) return;

            if (isFlagMode) {
                // Ch·∫ø ƒë·ªô c·∫Øm c·ªù
                if (!cell.isOpen) {
                    cell.isFlag = !cell.isFlag;
                    cell.div.innerText = cell.isFlag ? "üö©" : "";
                    cell.div.className = cell.isFlag ? "cell flag" : "cell";
                }
            } else {
                // Ch·∫ø ƒë·ªô m·ªü √¥
                if (cell.isFlag) return; // Kh√¥ng m·ªü √¥ c√≥ c·ªù
                
                if (cell.isMine) {
                    revealMines();
                    document.getElementById("status").innerText = "THUA R·ªíI!";
                    gameOver = true;
                } else {
                    openCell(cell);
                    checkWin();
                }
            }
        }

        function openCell(cell) {
            if (cell.isOpen || cell.isFlag) return;
            cell.isOpen = true;
            cell.div.className = "cell revealed";
            
            if (cell.count > 0) {
                cell.div.innerText = cell.count;
            } else {
                // N·∫øu l√† √¥ tr·ªëng (0), m·ªü loang ra
                for (var i = -1; i <= 1; i++) {
                    for (var j = -1; j <= 1; j++) {
                        var nr = cell.r + i, nc = cell.c + j;
                        if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
                            openCell(grid[nr][nc]);
                        }
                    }
                }
            }
        }

        function revealMines() {
            for (var r = 0; r < ROWS; r++) {
                for (var c = 0; c < COLS; c++) {
                    if (grid[r][c].isMine) {
                        grid[r][c].div.className = "cell bomb";
                        grid[r][c].div.innerText = "üí£";
                    }
                }
            }
        }

        function checkWin() {
            var openedCount = 0;
            for (var r = 0; r < ROWS; r++) {
                for (var c = 0; c < COLS; c++) {
                    if (grid[r][c].isOpen) openedCount++;
                }
            }
            if (openedCount === (ROWS * COLS - MINES)) {
                document.getElementById("status").innerText = "TH·∫ÆNG R·ªíI!";
                gameOver = true;
            }
        }

        // B·∫Øt ƒë·∫ßu game khi t·∫£i trang
        initGame();
    </script>
</body>
</html>